# Maintainer: Santiago Torres-Arias <santiago@archlinux.org>
# Contributor: Simon Boulay <simon.boulay@alkeona.net>

pkgbase=python-breathe
pkgname=('python-breathe' 'python2-breathe')
pkgver=4.11.0
pkgrel=2
pkgdesc="An extension to reStructuredText and Sphinx to be able to read and render Doxygen xml output."
arch=('any')
url="https://breathe.readthedocs.org/en/latest/"
license=('BSD')
makedepends=('python' 'python-setuptools' 'python2' 'python2-setuptools')
source=("git+https://github.com/michaeljones/breathe#tag=v${pkgver}?signed")
checkdepends=('python-nose' 'python2-nose' 'python-sphinx' 'python2-sphinx')
sha256sums=('SKIP')
validpgpkeys=('79DC0FAF18C31807E82E1A6B9EF1DC92B5F301BD') # Melvin Vermeeren <mail@mel.vin>

prepare() {
  cp -a "breathe" "breathe2"
}

check() {
  cd breathe

  PYTHONPATH=$PWD make test

  cd "${srcdir}/breathe2"

  PYTHONPATH=$PWD make test

}

build_python-breathe() {
  cd breathe
  python setup.py build

}

build_python2-breathe() {
  cd breathe2
  python setup.py build
}

package_python-breathe() {
  depends=('python' 'python-setuptools' 'python-sphinx')

  cd "breathe"
  python setup.py install --root="${pkgdir}" --optimize=1
}


package_python2-breathe() {
  depends=('python2' 'python2-setuptools' 'python2-sphinx')

  cd "breathe2"
  python2 setup.py install --root="${pkgdir}" --optimize=1

  # To avoid file conflict with the python3 version
  mv "${pkgdir}/usr/bin/breathe-apidoc" "${pkgdir}/usr/bin/breathe-apidoc2"
}
